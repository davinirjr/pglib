<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="pglib : A simple Python 3.3+ library for PostgreSQL based on libpq" />

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">
    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/toc.css">

    <title>pglib</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/mkleehammer/pglib">View on GitHub</a>

          <h1 id="project_title">pglib</h1>
          <h2 id="project_tagline">A simple Python 3.3+ library for PostgreSQL based on libpq</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/mkleehammer/pglib/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/mkleehammer/pglib/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">

      <ul class="toc">
        <li><a href="#welcome-to-pglib">Welcome to pglib</a></li>
        <li><a href="#quick-start">Quick Start</a></li>
        <li>
          <ul class="toc">
            <li><a href="#installing">Installing</a></li>
            <li><a href="#connecting">Connecting</a></li>
            <li><a href="#selection-basics">Selection Basics</a></li>
            <li><a href="#parameters">Parameters</a></li>
          </ul>
        </li>
      </ul>

<h2>
<a name="welcome-to-pglib" class="anchor" href="#welcome-to-pglib"><span class="octicon octicon-link"></span></a>Welcome to pglib</h2>

<p>pglib is a Python 3.3+ module for working with PostgreSQL databases.  It is a C extension
that exposes the <a href="http://www.postgresql.org/docs/9.3/static/libpq.html">libpq</a> API.
It is designed to be small, fast, and as convenient as possible that API to Python.</p>

<h2>
<a name="quick-start" class="anchor" href="#quick-start"><span class="octicon octicon-link"></span></a>Quick Start</h2>

<h3>
<a name="installing" class="anchor" href="#installing"><span class="octicon octicon-link"></span></a>Installing</h3>

<p><a href="https://github.com/mkleehammer/pglib/releases">Pre-built binaries</a> are
available for OS/X and Windows 64-bit Python.  For other operating systems see
<a href="building.html">building pglib</a>.</p>

<h3>
<a name="connecting" class="anchor" href="#connecting"><span class="octicon octicon-link"></span></a>Connecting</h3>

<pre>
import pglib
cnxn = pglib.connect('host=localhost dbname=test')
</pre>

<p>See the <a href="http://www.postgresql.org/docs/9.3/static/libpq-connect.html#LIBPQ-CONNSTRING">
libpq connection string</a> reference.</p>

<h3>
<a name="selection-basics" class="anchor" href="#selection-basics"><span class="octicon octicon-link"></span></a>Selection Basics</h3>

<p>Connection.execute accepts a SQL statement and optional parameters and returns a ResultSet.
A ResultSet is a collection of Row objects.  The result set that can be indexed into or used as
an iterator.</p>

<pre>
rset = cnxn.execute("select id, name from users")
print('count:', len(rows))
print('first:', row[0])
for row in rset:
    print(row)
</pre>

<p>Row objects are similar to tuples, but they also allow access to columns by name.</p>

<pre>
rset = cnxn.execute("select id, name from users limit 1")
row = rset[0]
print('id:', row[0]) # access id by column index
print('id:', row.id) # access id by column name
</pre>

<p>The SQL 'as' keyword makes it easy to set the name.</p>

<pre>
rset = cnxn.execute("select count(*) as cnt from users")
row = rset[0]
print(row.cnt)
</pre>

<p>The Connection.row method is a convenience method that returns the first result Row.  If
there are no results it returns None.</p>

<pre>
row = cnxn.row("select count(*) as cnt from users")
print(row.cnt)
</pre>

<p>The Connection.scalar method is another convenience method that returns the first column of
the first row.  If there are no results it returns None.</p>

<pre>
count = cnxn.scalar("select count(*) from users")
print(count)
</pre>

<h3>
<a name="parameters" class="anchor" href="#parameters"><span class="octicon octicon-link"></span></a>Parameters</h3>
    
<p>PostgreSQL supports parameters using $1, $2, etc. as a place holder in the SQL. You
provide the values for the question marks by passing them after the SQL</p>

<pre>
cnxn.execute("""
             select id, name
               from users
              where id > $1
                    and bill_overdue = $2
             """, 100, 1)
</pre>

<p>This is safer than putting the values into the string because the parameters are passed to
the database separately, protecting against SQL injection attacks.</p>

<p>Right now there is a limited set of data types accepted.  Open an
<a href="https://github.com/mkleehammer/pglib/issues">issue</a> to request new ones.</p>

<table>
  <thead>
    <tr><th>Python Type</th><th>SQL Type</th></tr>
  </thead>
  <tbody>
    <tr>
      <td>None</td>
      <td>NULL</td>
    </tr>
    <tr>
      <td>bool</td>
      <td>Boolean</td>
    </tr>
    <tr>
      <td>bytes</td>
      <td>binary</td>
    </tr>
    <tr>
      <td>bytearray</td>
      <td>binary</td>
    </tr>
    <tr>
      <td>datetime.date</td>
      <td>date</td>
    </tr>
    <tr>
      <td>datetime.datetime</td>
      <td>timestamp</td>
    </tr>
    <tr>
      <td>datetime.time</td>
      <td>time</td>
    </tr>
    <tr>
      <td>decimal.Decimal</td>
      <td>numeric</td>
    </tr>
    <tr>
      <td>float</td>
      <td>float8</td>
    </tr>
    <tr>
      <td>int</td>
      <td>int64 or numeric</td>
    </tr>
    <tr>
      <td>str</td>
      <td>text encoded as UTF-8</td>
    </tr>
    <tr>
      <td>uuid.UUID</td>
      <td>uuid</td>
    </tr>
  </tbody>
</table>

      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">pglib maintained by <a href="https://github.com/mkleehammer">mkleehammer</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>


  </body>
</html>
